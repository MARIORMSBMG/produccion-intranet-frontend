
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Formulario Habilitado con Turnos</title>
  <style>
    body { font-family: Arial; background: #f9f9f9; padding: 20px; }
    label, select, input { margin: 5px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #007BFF; color: white; }
    #infoResumen span { display: block; margin: 5px 0; }
  </style>
</head>
<body>

<h2>Formulario Habilitado con Turnos</h2>

<label for="nomina">Nómina: <input id="nomina" /></label><br />
<label for="nombre">Nombre: <input id="nombre" readonly /></label><br />
<label for="area">Área: <input id="area" value="Habilitado" readonly /></label><br />
<label for="fecha">Fecha: <input type="date" id="fecha" /></label><br />
<label for="turno">Turno:
  <select id="turno">
    <option value="">Selecciona turno</option>
    <option value="mixto">Mixto (7:00 - 16:30)</option>
    <option value="cuarto">4to (7:00 - 19:00)</option>
    <option value="tercero">3ro (19:00 - 5:30)</option>
    <option value="extra">Extra (7:00 - 15:00)</option>
  </select>
</label>

<div id="infoResumen" style="margin-top: 15px;">
  <strong>Resumen del Turno:</strong>
  <span>Horas jornada: <span id="horasJornada">0</span></span>
  <span>Tiempo comida: <span id="horasComida">0</span></span>
  <span>Tiempo interferencia total: <span id="interferenciaTotal">0</span> min</span>
  <span>Horas efectivas: <span id="horasEfectivas">0</span></span>
  <span>Eficiencia Global Ajustada: <span id="efFinal">0%</span></span>
</div>

<table>
  <thead>
    <tr>
      <th>Hora</th>
      <th>Código</th>
      <th>Estándar</th>
      <th>Piezas</th>
      <th>Interferencia (min)</th>
      <th>Tipo Interferencia</th>
      <th>Motivo</th>
    </tr>
  </thead>
  <tbody id="tablaHoras"></tbody>
</table>

<script>
const TURNOS = {
  mixto: { horas: 9.5, comida: 0.5 },
  cuarto: { horas: 12, comida: 0.75 },
  tercero: { horas: 10.5, comida: 0.5 },
  extra: { horas: 8, comida: 0.5 }
};

const horas = [
  "07:00-08:00", "08:00-09:00", "09:00-10:00", "10:00-11:00",
  "11:00-12:00", "12:00-13:00", "13:00-14:00", "14:00-15:00",
  "15:00-16:00", "16:00-17:00", "17:00-18:00", "18:00-19:00"
];

window.onload = () => {
  document.getElementById("fecha").valueAsDate = new Date();
  const tbody = document.getElementById("tablaHoras");
  horas.forEach(hora => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${hora}</td>
      <td><input class="codigo" /></td>
      <td><input class="estandar" /></td>
      <td><input type="number" class="piezas" /></td>
      <td><input type="number" class="interferencia" value="0" /></td>
      <td>
        <select class="tipoInterferencia">
          <option value="">Tipo</option>
          <option value="inevitable">Inevitable</option>
          <option value="evitable">Evitable</option>
        </select>
      </td>
      <td><input class="motivo" /></td>
    `;
    tbody.appendChild(row);
  });

  document.getElementById("turno").addEventListener("change", calcularResumen);
  document.querySelectorAll(".interferencia").forEach(input => input.addEventListener("input", calcularResumen));
};

function calcularResumen() {
  const tipoTurno = document.getElementById("turno").value;
  const resumen = TURNOS[tipoTurno] || { horas: 0, comida: 0 };
  document.getElementById("horasJornada").textContent = resumen.horas;
  document.getElementById("horasComida").textContent = resumen.comida;

  let totalInterferencia = 0;
  let totalPiezas = 0;
  let totalEstandar = 0;

  document.querySelectorAll("#tablaHoras tr").forEach(row => {
    const est = parseFloat(row.querySelector(".estandar").value) || 0;
    const pz = parseInt(row.querySelector(".piezas").value) || 0;
    const int = parseInt(row.querySelector(".interferencia").value) || 0;

    totalInterferencia += int;
    totalPiezas += pz;
    totalEstandar += est;
  });

  const horasEfectivas = resumen.horas - resumen.comida - (totalInterferencia / 60);
  const eficienciaGlobal = (totalEstandar > 0 && horasEfectivas > 0)
    ? (totalPiezas / (totalEstandar * horasEfectivas)) * 100
    : 0;

  document.getElementById("interferenciaTotal").textContent = totalInterferencia.toFixed(0);
  document.getElementById("horasEfectivas").textContent = horasEfectivas.toFixed(2);
  document.getElementById("efFinal").textContent = eficienciaGlobal.toFixed(1) + "%";
}
</script>

</body>
</html>
